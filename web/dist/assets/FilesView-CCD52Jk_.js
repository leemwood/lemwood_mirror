import{c as p,_ as H,r as h,u as N,a as U,o as A,b as n,d as i,e as c,w as m,f as y,F as f,g as w,h as d,i as b,j as C,k as B,l as S,m as s,H as R,n as T,t as g,p as E,q as O,s as P,v as z,x as Q,C as W,y as Z,D as G}from"./index-BCDqj3Be.js";import{S as J,_ as K}from"./Input-MmgH0ggT.js";/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=p("ArrowLeftIcon",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=p("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=p("FileArchiveIcon",[["path",{d:"M16 22h2a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v18",key:"1oywqq"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"20",r:"2",key:"1xzdoj"}],["path",{d:"M10 7V6",key:"dljcrl"}],["path",{d:"M10 12v-1",key:"v7bkov"}],["path",{d:"M10 18v-2",key:"1cjy8d"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=p("FileIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-vue-next v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=p("HardDriveIcon",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),se={class:"flex flex-col h-full space-y-4 max-w-full"},oe={class:"flex flex-col space-y-4 shrink-0"},re={class:"flex items-center justify-between gap-4"},ne={class:"flex items-center gap-2 overflow-hidden text-sm font-medium text-muted-foreground"},le={class:"relative w-40 md:w-64 shrink-0"},ce={key:0,class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4"},ie={key:1,class:"flex flex-col items-center justify-center py-20 text-muted-foreground"},de={key:2,class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 pb-20"},ue=["onClick"],he={class:"flex items-start justify-between mb-2"},pe={class:"p-2 rounded-lg bg-gradient-to-br from-primary/10 to-primary/5 text-primary group-hover:from-primary/20 group-hover:to-primary/10 transition-colors"},ve={key:0,class:"px-1.5 py-0.5 rounded-full bg-green-500/10 text-green-600 text-[9px] font-bold uppercase tracking-wider border border-green-500/20"},me={key:1,class:"flex gap-0.5"},ye={class:"flex flex-col gap-0.5 min-w-0"},fe=["title"],ge={class:"flex items-center justify-between text-[10px] text-muted-foreground mt-1"},xe={key:0},_e={key:1},ke={key:2},we={__name:"FilesView",setup(be){const x=h(!0),_=h(""),v=h({}),k=h({}),{copy:D}=N(),l=h([]),V=async()=>{x.value=!0;try{const[t,a]=await Promise.all([B(),S()]),e={};Object.keys(t.data).sort().forEach(u=>{e[u]=t.data[u].sort((o,r)=>String(r.tag_name||r.name).localeCompare(String(o.tag_name||o.name)))}),v.value=e,k.value=a.data}catch(t){console.error(t)}finally{x.value=!1}},M=t=>{var e;const a=(e=t.split(".").pop())==null?void 0:e.toLowerCase();return["zip","tar","gz","7z","rar"].includes(a)?ee:["exe","msi","apk","dmg"].includes(a)?ae:te},$=t=>{if(!t)return"未知";try{return new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"})}catch{return t}},F=t=>{D(t)},q=(t,a)=>{a==="launcher"?l.value=[{name:t,id:t,type:"launcher"}]:a==="version"&&l.value.push({name:t.name,id:t.id,type:"version",data:t.data})},I=()=>{l.value.pop()},L=t=>{t===-1?l.value=[]:l.value=l.value.slice(0,t+1)},j=U(()=>{const t=_.value.toLowerCase().trim(),a=l.value.length;if(a===0)return Object.keys(v.value).map(e=>({id:e,name:e,type:"launcher",count:v.value[e].length,latest:k.value[e]})).filter(e=>!t||e.name.toLowerCase().includes(t));if(a===1){const e=l.value[0].id;return(v.value[e]||[]).map(o=>{var r;return{id:o.tag_name||o.name,name:o.tag_name||o.name,type:"version",date:o.published_at,isLatest:k.value[e]===(o.tag_name||o.name),data:o,fileCount:((r=o.assets)==null?void 0:r.length)||0}}).filter(o=>!t||o.name.toLowerCase().includes(t))}else if(a===2){const e=l.value[1].data,u=l.value[0].id,o=l.value[1].id;return(e.assets||[]).map(r=>({id:r.name,name:r.name,type:"file",size:r.size,downloadUrl:r.url&&r.url.startsWith("http")?r.url:`${window.location.origin}/download/${u}/${o}/${r.name}`})).filter(r=>!t||r.name.toLowerCase().includes(t))}return[]});return A(()=>{V()}),(t,a)=>(s(),n("div",se,[i("div",oe,[i("div",re,[i("div",ne,[c(y,{variant:"ghost",size:"icon",class:"h-8 w-8 shrink-0",onClick:a[0]||(a[0]=e=>L(-1)),disabled:!l.value.length},{default:m(()=>[c(d(R),{class:"h-4 w-4"})]),_:1},8,["disabled"]),(s(!0),n(f,null,w(l.value,(e,u)=>(s(),n(f,{key:e.id},[c(d(Y),{class:"h-4 w-4 shrink-0 opacity-50"}),c(y,{variant:"ghost",size:"sm",class:"h-8 px-2 truncate max-w-[120px]",onClick:o=>L(u)},{default:m(()=>[T(g(e.name),1)]),_:2},1032,["onClick"])],64))),128))]),i("div",le,[c(d(J),{class:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),c(K,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=e=>_.value=e),type:"search",placeholder:"筛选...",class:"pl-8 h-9 bg-background/50 backdrop-blur border-white/10"},null,8,["modelValue"])])])]),x.value?(s(),n("div",ce,[(s(),n(f,null,w(10,e=>c(E,{class:"aspect-square rounded-xl",key:e})),64))])):j.value.length?(s(),n("div",de,[l.value.length>0?(s(),n("div",{key:0,onClick:I,class:"group relative flex flex-col items-center justify-center gap-2 p-3 rounded-xl border border-dashed border-muted-foreground/20 bg-muted/5 hover:bg-muted/10 cursor-pointer transition-all hover:scale-[1.02] active:scale-[0.98]"},[c(d(X),{class:"h-6 w-6 text-muted-foreground group-hover:text-foreground transition-colors"}),a[3]||(a[3]=i("span",{class:"text-xs font-medium text-muted-foreground"},"返回上一级",-1))])):C("",!0),(s(!0),n(f,null,w(j.value,e=>(s(),n("div",{key:e.id,onClick:u=>e.type!=="file"?q(e.type==="launcher"?e.name:e,e.type):null,class:O(d(P)("group relative flex flex-col justify-between p-3 rounded-xl border border-white/5 bg-background/40 backdrop-blur-md shadow-sm transition-all duration-200",e.type!=="file"?"cursor-pointer hover:bg-background/60 hover:border-white/20 hover:shadow-md hover:scale-[1.02] active:scale-[0.98]":""))},[i("div",he,[i("div",pe,[e.type==="launcher"?(s(),z(d(b),{key:0,class:"h-5 w-5"})):e.type==="version"?(s(),z(d(b),{key:1,class:"h-5 w-5"})):(s(),z(Q(M(e.name)),{key:2,class:"h-5 w-5"}))]),e.isLatest?(s(),n("div",ve," Latest ")):C("",!0),e.type==="file"?(s(),n("div",me,[c(y,{size:"icon",variant:"ghost",class:"h-6 w-6",onClick:Z(u=>F(e.downloadUrl),["stop"])},{default:m(()=>[c(d(W),{class:"h-3 w-3"})]),_:1},8,["onClick"]),c(y,{size:"icon",variant:"ghost",class:"h-6 w-6",as:"a",href:e.downloadUrl},{default:m(()=>[c(d(G),{class:"h-3 w-3"})]),_:1},8,["href"])])):C("",!0)]),i("div",ye,[i("h3",{class:"font-medium truncate text-sm leading-none",title:e.name},g(e.name),9,fe),i("div",ge,[e.type==="launcher"?(s(),n("span",xe,g(e.count)+" 版本",1)):e.type==="version"?(s(),n("span",_e,g($(e.date)),1)):(s(),n("span",ke,"文件"))])])],10,ue))),128))])):(s(),n("div",ie,[c(d(b),{class:"h-16 w-16 mb-4 opacity-20"}),a[2]||(a[2]=i("p",null,"空文件夹",-1))]))]))}},Le=H(we,[["__scopeId","data-v-a6548887"]]);export{Le as default};
